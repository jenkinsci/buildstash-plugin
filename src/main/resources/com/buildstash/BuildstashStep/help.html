<!DOCTYPE html>
<html>
<head>
    <title>Buildstash Step Help</title>
</head>
<body>
    <h2>Buildstash Upload Step</h2>
    
    <p>This step uploads build artifacts to the Buildstash web service.</p>
    
    <h3>Required Parameters</h3>
    <ul>
        <li><strong>API Key</strong>: Your Buildstash API key for authentication</li>
        <li><strong>Primary File Path</strong>: Path to the file you want to upload (relative to workspace)</li>
        <li><strong>Major Version</strong>: Major version component (e.g., "1")</li>
        <li><strong>Minor Version</strong>: Minor version component (e.g., "0")</li>
        <li><strong>Patch Version</strong>: Patch version component (e.g., "0")</li>
        <li><strong>Platform</strong>: Target platform (e.g., "ios", "android")</li>
        <li><strong>Stream</strong>: Build stream (e.g., "development", "production")</li>
    </ul>
    
    <h3>Optional Parameters</h3>
    <ul>
        <li><strong>Structure</strong>: Upload structure type ("file" or "file+expansion")</li>
        <li><strong>Expansion File Path</strong>: Path to expansion file (required if structure is "file+expansion")</li>
        <li><strong>Extra Version</strong>: Extra version component (e.g., "beta")</li>
        <li><strong>Meta Version</strong>: Meta version component (e.g., "build.123")</li>
        <li><strong>Custom Build Number</strong>: Custom build number</li>
        <li><strong>Labels</strong>: Labels for the build (comma-seperated)</li>
        <li><strong>Architectures</strong>: Supported architectures (comma-seperated)</li>
        <li><strong>Notes</strong>: Additional notes about the build</li>
    </ul>
    
    <h3>CI/CD Parameters</h3>
    <ul>
        <li><strong>CI Pipeline</strong>: Name of the CI pipeline (automatically set to the project/job name)</li>
        <li><strong>CI Run ID</strong>: CI run identifier (automatically set to build number)</li>
        <li><strong>CI Run URL</strong>: URL to the CI run (automatically set to build URL)</li>
        <li><strong>CI Build Duration</strong>: Build duration (automatically set to actual build duration in HH:mm:ss format)</li>
    </ul>
    <p><strong>Note:</strong> CI/CD parameters are automatically populated from Jenkins context and cannot be manually set in pipeline steps.</p>
    
    <h3>Version Control Parameters</h3>
    <ul>
        <li><strong>VC Host Type</strong>: Version control host type (default: "git")</li>
        <li><strong>VC Host</strong>: Version control host (default: "github")</li>
        <li><strong>VC Repo Name</strong>: Repository name</li>
        <li><strong>VC Repo URL</strong>: Repository URL</li>
        <li><strong>VC Branch</strong>: Branch name</li>
        <li><strong>VC Commit SHA</strong>: Commit SHA</li>
        <li><strong>VC Commit URL</strong>: Commit URL</li>
    </ul>
    
    <h3>Dynamic Values with Environment Variables</h3>
    <p>All fields support dynamic values using environment variables. In pipeline scripts, you can use Groovy variables directly or string expansion.</p>
    <p><strong>Examples:</strong></p>
    <ul>
        <li>Direct variable: <code>platform: env.PLATFORM</code></li>
        <li>String expansion: <code>platform: '${PLATFORM}'</code></li>
        <li>File path: <code>primaryFilePath: "${env.WORKSPACE}/build/app.ipa"</code></li>
    </ul>
    <p>This works for all fields including file paths, version components, platform, stream, labels, architectures, and SCM fields.</p>
    
    <h3>Example Usage</h3>
    <pre><code>
// Using environment variables
buildstash(
    apiKey: 'your-api-key',
    structure: 'file',
    primaryFilePath: "${env.WORKSPACE}/build/app.ipa",
    versionComponent1Major: '1',
    versionComponent2Minor: '0',
    versionComponent3Patch: '0',
    platform: env.PLATFORM,      // Using environment variable
    stream: env.STREAM            // Using environment variable
)

// Or with string expansion
buildstash(
    apiKey: 'your-api-key',
    primaryFilePath: '${WORKSPACE}/build/app.ipa',
    versionComponent1Major: '1',
    versionComponent2Minor: '0',
    versionComponent3Patch: '0',
    platform: '${PLATFORM}',     // String expansion
    stream: '${STREAM}'            // String expansion
)
    </code></pre>
    
    <p>For more information, visit the <a href="https://docs.buildstash.com">Buildstash Documentation</a>.</p>
</body>
</html> 